/*
 * PasswordListGeneratorFrame.java
 *
 * Created on 16. Oktober 2008, 16:49
 */
package jcrypter.password;

import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.util.Iterator;
import java.util.List;
import java.util.ListIterator;
import java.util.ResourceBundle;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JFileChooser;
import javax.swing.SpinnerNumberModel;
import jcrypter.JCrypterFrame;

/**
 *
 * @author  uli
 */
public class PasswordListGeneratorFrame extends javax.swing.JFrame
{

    /** Creates new form PasswordListGeneratorFrame
     * @param parent 
     */
    public PasswordListGeneratorFrame(PasswordGeneratorFrame parent)
    {
        initComponents();
        this.parent = parent;
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        outputTypeRadioButton = new javax.swing.ButtonGroup();
        jPanel1 = new javax.swing.JPanel();
        plaintextRadioButton = new javax.swing.JRadioButton();
        latexRadioButton = new javax.swing.JRadioButton();
        countLabel = new javax.swing.JLabel();
        countSpinner = new javax.swing.JSpinner();
        okButton = new javax.swing.JButton();
        columnsLabel = new javax.swing.JLabel();
        columnSpinner = new javax.swing.JSpinner();
        enumerateCheckbox = new javax.swing.JCheckBox();

        setTitle(i18n.getString("PasswordListGeneratorFrame.title")); // NOI18N

        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder(i18n.getString("PasswordListGeneratorFrame.jPanel1.border.title"))); // NOI18N

        outputTypeRadioButton.add(plaintextRadioButton);
        plaintextRadioButton.setMnemonic('p');
        plaintextRadioButton.setSelected(true);
        plaintextRadioButton.setText(i18n.getString("PasswordListGeneratorFrame.plaintextRadioButton.text")); // NOI18N
        jPanel1.add(plaintextRadioButton);

        outputTypeRadioButton.add(latexRadioButton);
        latexRadioButton.setMnemonic('l');
        latexRadioButton.setText(i18n.getString("PasswordListGeneratorFrame.latexRadioButton.text")); // NOI18N
        jPanel1.add(latexRadioButton);

        countLabel.setText(i18n.getString("PasswordListGeneratorFrame.countLabel.text")); // NOI18N

        countSpinner.setModel(new SpinnerNumberModel(100,0,2000000,1));

        okButton.setText(i18n.getString("PasswordListGeneratorFrame.okButton.text")); // NOI18N
        okButton.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                okButtonMouseClicked(evt);
            }
        });

        columnsLabel.setText(i18n.getString("PasswordListGeneratorFrame.columnsLabel.text")); // NOI18N

        columnSpinner.setModel(new SpinnerNumberModel(2,0,50,1));

        enumerateCheckbox.setSelected(true);
        enumerateCheckbox.setText(i18n.getString("PasswordListGeneratorFrame.enumerateCheckbox.text")); // NOI18N

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, 220, Short.MAX_VALUE)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(columnsLabel)
                            .addComponent(countLabel))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(countSpinner, javax.swing.GroupLayout.DEFAULT_SIZE, 149, Short.MAX_VALUE)
                            .addComponent(enumerateCheckbox)
                            .addComponent(columnSpinner, javax.swing.GroupLayout.DEFAULT_SIZE, 149, Short.MAX_VALUE)))
                    .addComponent(okButton, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 220, Short.MAX_VALUE))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(countLabel)
                    .addComponent(countSpinner, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(columnsLabel)
                    .addComponent(columnSpinner, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(enumerateCheckbox)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(okButton)
                .addContainerGap(13, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

private void okButtonMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_okButtonMouseClicked
    //Update the password generator charset
    parent.updateCharset();
    //Show a file selection dialog to ask the user where to save the passwords
    fileChooser.showSaveDialog(this);
    File file = fileChooser.getSelectedFile();
    //Call the apropriate method (depending on the selected checkbox)
    if (plaintextRadioButton.isSelected())
    {
        generatePlaintextList(file);
    }
    else if (latexRadioButton.isSelected())
    {
    }
}//GEN-LAST:event_okButtonMouseClicked

    private void generatePlaintextList(File file)
    {
        //Initialize the file writer
        FileWriter fw = null;
        try
        {
            PasswordGenerator pwgen = parent.getPwgen();
            int count = getCount();
            int cols = getColumns();
            fw = new FileWriter(file);
            //Generate the password list
            List<char[]> pwList =
                    pwgen.generatePasswordList(parent.getLength(), count);
            //Main write loop
            int colCount = 0;
            boolean enumerate = enumerateCheckbox.isSelected();
            Iterator<char[]> pwIterator = pwList.iterator();
            for (int i = 1; i <= count; i++)
            {
                if (enumerate)
                {
                    fw.write(i + ": "); //Write the password number if selected
                }
                fw.write(new String(pwIterator.next())); //Write the password
                fw.write(' '); //Put a space between two passwords
                colCount++;
                if (colCount == cols)
                {
                    fw.write("\n");
                    colCount = 0;
                }
            }
        }
        catch (IOException ex)
        {
            Logger.getLogger(PasswordListGeneratorFrame.class.getName()).log(Level.SEVERE, null, ex);
        }
        finally
        {
            try
            {
                fw.close();
            }
            catch (IOException ex)
            {
                Logger.getLogger(PasswordListGeneratorFrame.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
    }
    private PasswordGeneratorFrame parent = null;
    private ResourceBundle i18n =
            ResourceBundle.getBundle("jcrypter/password/Bundle");
    private JFileChooser fileChooser = JCrypterFrame.mainFrame.fileChooser;
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JSpinner columnSpinner;
    private javax.swing.JLabel columnsLabel;
    private javax.swing.JLabel countLabel;
    private javax.swing.JSpinner countSpinner;
    private javax.swing.JCheckBox enumerateCheckbox;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JRadioButton latexRadioButton;
    private javax.swing.JButton okButton;
    private javax.swing.ButtonGroup outputTypeRadioButton;
    private javax.swing.JRadioButton plaintextRadioButton;
    // End of variables declaration//GEN-END:variables
    private int getCount()
    {
        SpinnerNumberModel countModel =
                (SpinnerNumberModel) countSpinner.getModel();
        return countModel.getNumber().intValue();
    }

    private int getColumns()
    {
        SpinnerNumberModel columnModel =
                (SpinnerNumberModel) columnSpinner.getModel();
        return columnModel.getNumber().intValue();
    }
}
